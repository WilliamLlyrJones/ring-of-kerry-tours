<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Ring of Kerry Adventure - Personalized Itinerary</title>
    <meta name="description" content="Your personalized Ring of Kerry itinerary, created by AI and tailored to your preferences.">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .back-link {
            color: #4a7c59;
            text-decoration: none;
            margin-bottom: 20px;
            display: inline-block;
            font-weight: 500;
            transition: color 0.3s ease;
        }
        
        .back-link:hover {
            color: #2d5a3d;
        }
        
        .header h1 {
            font-size: 2.5em;
            color: #2d5a3d;
            margin-bottom: 10px;
        }
        
        .header .summary {
            font-size: 1.2em;
            color: #666;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }
        
        .special-requirements-section {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8f0 100%);
            border-radius: 12px;
            border-left: 4px solid #4a7c59;
        }
        
        .requirements-title {
            font-weight: 600;
            color: #2d5a3d;
            font-size: 1.1em;
            margin-bottom: 12px;
        }
        
        .requirements-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .requirement-highlight {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            border: 1px solid;
        }
        
        .requirement-highlight.dietary {
            background: #fff3cd;
            color: #856404;
            border-color: #ffeaa7;
        }
        
        .requirement-highlight.accessibility {
            background: #d1ecf1;
            color: #0c5460;
            border-color: #bee5eb;
        }
        
        .requirement-highlight.special {
            background: #f8d7da;
            color: #721c24;
            border-color: #f5c6cb;
        }
        
        .requirement-highlight.style {
            background: #e2e3e5;
            color: #383d41;
            border-color: #d6d8db;
        }
        
        .requirement-highlight.accommodation {
            background: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
        }
        
        .requirements-note {
            font-size: 0.9em;
            color: #2d5a3d;
            font-style: italic;
            margin-top: 8px;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: #4a7c59;
            color: white;
        }
        
        .btn-primary:hover {
            background: #3d6449;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 124, 89, 0.3);
        }
        
        .btn-secondary {
            background: white;
            color: #4a7c59;
            border: 2px solid #4a7c59;
        }
        
        .btn-secondary:hover {
            background: #4a7c59;
            color: white;
        }
        
        .btn-outline {
            background: transparent;
            color: #666;
            border: 2px solid #ddd;
        }
        
        .btn-outline:hover {
            background: #f8f9fa;
            border-color: #4a7c59;
            color: #4a7c59;
        }
        
        .itinerary-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            line-height: 1.8;
        }
        
        .itinerary-content h2 {
            color: #2d5a3d;
            font-size: 1.8em;
            margin: 40px 0 20px 0;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            border-left: 5px solid #4a7c59;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .itinerary-content h2:first-child {
            margin-top: 0;
        }
        
        .itinerary-content h3 {
            color: #4a7c59;
            font-size: 1.3em;
            margin: 25px 0 15px 0;
            padding: 15px 20px;
            background: #f0f8ff;
            border-radius: 10px;
            border-left: 4px solid #007bff;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .itinerary-content h3::before {
            content: 'üïí';
            font-size: 1.1em;
        }
        
        .itinerary-content h4 {
            color: #2d5a3d;
            font-size: 1.2em;
            margin: 20px 0 8px 0;
        }
        
        .itinerary-content p {
            margin-bottom: 15px;
            color: #444;
            padding-left: 20px;
        }
        
        .itinerary-content strong {
            color: #2d5a3d;
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 4px;
        }
        
        .day-section {
            margin-bottom: 40px;
            border: 1px solid #e9ecef;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .time-block {
            background: #fff;
            margin: 20px 0;
            border-radius: 10px;
            border: 1px solid #f0f0f0;
            overflow: hidden;
        }
        
        .activity-content {
            padding: 20px;
            background: #fafafa;
            border-left: 3px solid #4a7c59;
            margin: 10px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .location-highlight {
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8f0 100%);
            color: #2d5a3d;
            padding: 3px 8px;
            border-radius: 12px;
            font-weight: 600;
            display: inline-block;
            margin: 0 3px;
            border: 1px solid #d4edda;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin: 40px 0;
        }
        
        .loading {
            text-align: center;
            padding: 60px 20px;
        }
        
        .spinner {
            border: 4px solid #e0e0e0;
            border-top: 4px solid #4a7c59;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 30px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            text-align: center;
        }
        
        .share-url {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #ddd;
            margin: 20px 0;
            word-break: break-all;
            font-family: monospace;
        }
        
        .download-options {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }
        
        .download-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .download-option:hover {
            border-color: #4a7c59;
            background-color: #f8f9fa;
        }
        
        .tips-section {
            background: #f0f8ff;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            border-left: 4px solid #007bff;
        }
        
        .tips-section h3 {
            color: #007bff;
            margin-bottom: 15px;
        }
        
        .tip-list {
            list-style: none;
            padding: 0;
        }
        
        .tip-list li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
        }
        
        .tip-list li::before {
            content: 'üí°';
            position: absolute;
            left: 0;
        }
        
        .disclaimer-section {
            background: #fff3cd;
            border: 2px solid #ffeaa7;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            border-left: 4px solid #f39c12;
        }
        
        .disclaimer-section h3 {
            color: #856404;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .disclaimer-content {
            color: #856404;
            line-height: 1.6;
        }
        
        .disclaimer-content p {
            margin-bottom: 15px;
        }
        
        .disclaimer-content ul {
            margin: 15px 0;
            padding-left: 20px;
        }
        
        .disclaimer-content li {
            margin-bottom: 8px;
        }
        
        .disclaimer-content strong {
            color: #7d4e00;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .itinerary-content {
                padding: 25px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="/planner" class="back-link">‚Üê Back to Trip Planner</a>
        
        <div id="loadingState" class="loading">
            <div class="spinner"></div>
            <h2>Loading your itinerary...</h2>
            <p>Please wait while we retrieve your personalized Ring of Kerry adventure.</p>
        </div>
        
        <div id="errorState" class="error-message" style="display: none;">
            <h2>Oops! Something went wrong</h2>
            <p>We could not load your itinerary. This might happen if you navigated directly to this page without completing the questionnaire.</p>
            <a href="/planner" class="btn btn-primary" style="margin-top: 15px;">Start New Trip Plan</a>
        </div>
        
        <div id="mainContent" style="display: none;">
            <div class="header">
                <h1>üçÄ Your Ring of Kerry Adventure</h1>
                <div class="summary" id="tripSummary">
                    <!-- Summary will be populated -->
                </div>
            </div>
            
            <div class="controls">
                <button class="btn btn-primary" onclick="showDownloadOptions()">üì± Download Itinerary</button>
                <button class="btn btn-secondary" onclick="showShareModal()">üì§ Share</button>
                <button class="btn btn-outline" onclick="printItinerary()">üñ®Ô∏è Print</button>
            </div>
            
            <div class="itinerary-content" id="itineraryContent">
                <!-- Itinerary will be populated -->
            </div>
            
            <div class="tips-section">
                <h3>üí° Insider Tips for Your Trip</h3>
                <ul class="tip-list">
                    <li><strong>Driving:</strong> Irish roads are narrower than American roads. Take your time and use passing places courteously.</li>
                    <li><strong>Weather:</strong> Irish weather can be unpredictable. Pack layers and a waterproof jacket.</li>
                    <li><strong>Photography:</strong> Best light is usually in the morning (golden hour) and late afternoon.</li>
                    <li><strong>Dining:</strong> Make dinner reservations, especially on weekends. Irish dinners are typically served 6-9 PM.</li>
                    <li><strong>Currency:</strong> Ireland uses the Euro (‚Ç¨). Most places accept cards, but carry some cash for small purchases.</li>
                    <li><strong>Tipping:</strong> 10-15% is standard for good service in restaurants.</li>
                </ul>
            </div>

            <!-- Important Disclaimer Section -->
            <div class="disclaimer-section">
                <h3>‚ö†Ô∏è Important Disclaimer</h3>
                <div class="disclaimer-content">
                    <p><strong>These itinerary suggestions are for informational purposes only.</strong> Ring of Kerry Tours provides these recommendations as general guidance to help plan your trip.</p>
                    
                    <p><strong>You must verify all information before your visit:</strong></p>
                    <ul>
                        <li>Restaurant opening hours, menus, and dietary accommodation capabilities</li>
                        <li>Attraction opening times, admission fees, and accessibility features</li>
                        <li>Road conditions, parking availability, and route accessibility</li>
                        <li>Weather conditions and seasonal activity availability</li>
                        <li>Booking requirements and contact information</li>
                    </ul>
                    
                    <p><strong>Liability Limitation:</strong> Ring of Kerry Tours accepts no liability for any errors, omissions, or changes in the information provided. Businesses may close, change hours, modify accessibility features, or alter services without notice. Travelers are responsible for confirming all details independently before making any bookings or visiting locations.</p>
                    
                    <p><strong>Special Requirements:</strong> If you have specific dietary, accessibility, or other special requirements, please contact venues directly to confirm their current ability to accommodate your needs.</p>
                    
                    <p>Always prioritize your safety and comfort when making travel decisions.</p>
                </div>
            </div>
        </div>
        
        <!-- Share Modal -->
        <div id="shareModal" class="modal">
            <div class="modal-content">
                <h3>Share Your Itinerary</h3>
                <p>Copy this link to share your personalized Ring of Kerry itinerary:</p>
                <div class="share-url" id="shareUrl">
                    <!-- URL will be populated -->
                </div>
                <div style="display: flex; gap: 15px; justify-content: center; margin-top: 20px;">
                    <button class="btn btn-primary" onclick="copyShareLink()">Copy Link</button>
                    <button class="btn btn-outline" onclick="closeShareModal()">Close</button>
                </div>
            </div>
        </div>
        
        <!-- Download Options Modal -->
        <div id="downloadModal" class="modal">
            <div class="modal-content">
                <h3>Download Your Itinerary</h3>
                <p>Choose your preferred format:</p>
                <div class="download-options">
                    <div class="download-option" onclick="downloadAsPDF()">
                        <div>
                            <strong>üìÑ PDF Document</strong>
                            <div style="font-size: 0.9em; color: #666;">Professional format, easy to print</div>
                        </div>
                        <span>‚Üí</span>
                    </div>
                    <div class="download-option" onclick="downloadAsText()">
                        <div>
                            <strong>üìù Text File</strong>
                            <div style="font-size: 0.9em; color: #666;">Simple text format, works everywhere</div>
                        </div>
                        <span>‚Üí</span>
                    </div>
                    <div class="download-option" onclick="emailItinerary()">
                        <div>
                            <strong>üìß Email to Myself</strong>
                            <div style="font-size: 0.9em; color: #666;">Send to your email address</div>
                        </div>
                        <span>‚Üí</span>
                    </div>
                </div>
                <button class="btn btn-outline" onclick="closeDownloadModal()" style="margin-top: 20px;">Close</button>
            </div>
        </div>
    </div>

    <script>
        console.log("Script starting");
        
        var currentItinerary = null;
        var currentUserData = null;
        var itineraryId = null;
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM loaded - starting loadItinerary");
            loadItinerary();
        });
        
        function loadItinerary() {
            console.log("loadItinerary function called");
            
            try {
                var urlParams = new URLSearchParams(window.location.search);
                var sharedId = urlParams.get('id');
                
                if (sharedId) {
                    console.log("Found shared ID: " + sharedId);
                    loadSharedItinerary(sharedId);
                    return;
                }
                
                var itineraryData = sessionStorage.getItem('generatedItinerary');
                var userData = sessionStorage.getItem('userData');
                
                console.log("Session storage check:");
                console.log("Has itinerary: " + (!!itineraryData));
                console.log("Has userData: " + (!!userData));
                
                if (!itineraryData || !userData) {
                    console.log("No session data - showing error");
                    showError();
                    return;
                }
                
                var itinerary = JSON.parse(itineraryData);
                currentUserData = JSON.parse(userData);
                currentItinerary = itinerary.itinerary || itinerary;
                itineraryId = itinerary.itineraryId;
                
                console.log("Data parsed successfully");
                displayItinerary();
                
            } catch (error) {
                console.error("Error in loadItinerary: " + error.message);
                showError();
            }
        }
        
        function loadSharedItinerary(id) {
            console.log("loadSharedItinerary called with: " + id);
            
            fetch('/.netlify/functions/get-itinerary/' + id)
                .then(function(response) {
                    if (!response.ok) {
                        throw new Error('Itinerary not found');
                    }
                    return response.json();
                })
                .then(function(data) {
                    currentItinerary = data.itinerary.itineraryText;
                    currentUserData = data.itinerary.userData;
                    itineraryId = data.itinerary.id;
                    
                    console.log("Shared itinerary loaded");
                    displayItinerary();
                })
                .catch(function(error) {
                    console.error("Error loading shared itinerary: " + error.message);
                    showError();
                });
        }
        
        function displayItinerary() {
            console.log("displayItinerary called");
            
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            
            populateSummary(currentUserData);
            populateItinerary(currentItinerary);
        }
        
        function showError() {
            console.log("showError called");
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('errorState').style.display = 'block';
        }
        
        function populateSummary(userData) {
            console.log("populateSummary called");
            
            var summaryElement = document.getElementById('tripSummary');
            var interests = userData && userData.interests ? userData.interests.join(', ') : 'general sightseeing';
            
            // Build the basic summary
            var summaryHTML = '<strong>' + userData.duration + '-Day Itinerary</strong> ‚Ä¢ ' + userData.travelMonth + ' 2025 ‚Ä¢ ' + userData.groupSize + ' people ‚Ä¢ ‚Ç¨' + userData.budget + '/day budget<br>Interests: ' + interests;
            
            // Add special requirements section if any exist
            var specialRequirements = [];
            
            if (userData.dietaryRequirements) {
                specialRequirements.push('<span class="requirement-highlight dietary">üçΩÔ∏è Dietary: ' + userData.dietaryRequirements + '</span>');
            }
            
            if (userData.accessibilityNeeds) {
                specialRequirements.push('<span class="requirement-highlight accessibility">‚ôø Accessibility: ' + userData.accessibilityNeeds + '</span>');
            }
            
            if (userData.specialRequests) {
                specialRequirements.push('<span class="requirement-highlight special">‚ú® Special Requests: ' + userData.specialRequests + '</span>');
            }
            
            if (userData.travelStyle && userData.travelStyle !== 'balanced pace') {
                specialRequirements.push('<span class="requirement-highlight style">üéØ Travel Style: ' + userData.travelStyle + '</span>');
            }
            
            if (userData.accommodation && userData.accommodation !== 'mid-range hotels/B&Bs') {
                specialRequirements.push('<span class="requirement-highlight accommodation">üè® Accommodation: ' + userData.accommodation + '</span>');
            }
            
            // Add special requirements to summary if any exist
            if (specialRequirements.length > 0) {
                summaryHTML += '<div class="special-requirements-section">';
                summaryHTML += '<div class="requirements-title">‚úÖ Your specific requirements have been incorporated:</div>';
                summaryHTML += '<div class="requirements-list">' + specialRequirements.join('') + '</div>';
                summaryHTML += '<div class="requirements-note">Every recommendation below has been carefully selected to accommodate these needs.</div>';
                summaryHTML += '</div>';
            }
            
            summaryElement.innerHTML = summaryHTML;
        }
        
        function populateItinerary(itinerary) {
            console.log("populateItinerary called");
            
            var contentElement = document.getElementById('itineraryContent');
            
            if (!itinerary) {
                contentElement.innerHTML = '<p>No itinerary content available.</p>';
                return;
            }
            
            var formattedItinerary = itinerary;
            
            // First, convert **bold** to styled strong tags (before adding <br> tags)
            formattedItinerary = formattedItinerary.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            // Convert "DAY X:" patterns to h2 headers (before <br> conversion)
            formattedItinerary = formattedItinerary.replace(/^(DAY \d+[^\n]*)/gm, '<h2>$1</h2>');
            
            // Remove the dashed lines that follow day headers (they're just visual clutter now)
            formattedItinerary = formattedItinerary.replace(/^-{20,}$/gm, '<div class="day-separator"></div>');
            
            // Convert "MORNING:", "AFTERNOON:", "EVENING:" to h3 headers (before <br> conversion)
            formattedItinerary = formattedItinerary.replace(/^(MORNING|AFTERNOON|EVENING):$/gm, '<h3>$1</h3>');
            
            // Convert time patterns like "8:00 AM" etc to h3 headers WITHOUT clock emoji
            formattedItinerary = formattedItinerary.replace(/^(\d{1,2}:\d{2}\s*[AP]M[^\n]*)/gm, '<h3>$1</h3>');
            
            // Now convert line breaks to HTML
            formattedItinerary = formattedItinerary.replace(/\n/g, '<br>');
            
            console.log("Formatted itinerary:", formattedItinerary.substring(0, 500));
            
            contentElement.innerHTML = formattedItinerary;
        }
        
        function showShareModal() {
            console.log("showShareModal called");
            var modal = document.getElementById('shareModal');
            var shareUrl = document.getElementById('shareUrl');
            
            if (itineraryId) {
                var url = window.location.origin + '/planner/itinerary.html?id=' + itineraryId;
                shareUrl.textContent = url;
            } else {
                shareUrl.textContent = 'Shareable link not available for this itinerary';
            }
            
            modal.style.display = 'block';
        }
        
        function closeShareModal() {
            document.getElementById('shareModal').style.display = 'none';
        }
        
        function copyShareLink() {
            var shareUrl = document.getElementById('shareUrl').textContent;
            if (navigator.clipboard) {
                navigator.clipboard.writeText(shareUrl).then(function() {
                    alert('Link copied to clipboard!');
                    closeShareModal();
                }).catch(function() {
                    alert('Unable to copy link. Please copy manually.');
                });
            } else {
                alert('Unable to copy link. Please copy manually.');
            }
        }
        
        function showDownloadOptions() {
            console.log("showDownloadOptions called");
            document.getElementById('downloadModal').style.display = 'block';
        }
        
        function closeDownloadModal() {
            document.getElementById('downloadModal').style.display = 'none';
        }
        
        function downloadAsPDF() {
            console.log("downloadAsPDF called");
            var printContent = createPrintableContent();
            var newWindow = window.open('', '_blank');
            if (newWindow) {
                var htmlContent = '<!DOCTYPE html><html><head><title>Ring of Kerry Itinerary</title><style>body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; } h1 { color: #2d5a3d; text-align: center; } h2 { color: #4a7c59; border-bottom: 2px solid #4a7c59; padding-bottom: 5px; } h3 { color: #2d5a3d; } .summary { background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0; }</style></head><body>' + printContent + '</body></html>';
                newWindow.document.write(htmlContent);
                newWindow.document.close();
                newWindow.print();
            }
            closeDownloadModal();
        }
        
        function downloadAsText() {
            console.log("downloadAsText called");
            var textContent = createTextContent();
            var blob = new Blob([textContent], { type: 'text/plain' });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = 'ring-of-kerry-itinerary.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            closeDownloadModal();
        }
        
        function emailItinerary() {
            console.log("emailItinerary called");
            var textContent = createTextContent();
            var subject = encodeURIComponent('My Ring of Kerry Itinerary');
            var body = encodeURIComponent(textContent);
            var mailtoLink = 'mailto:?subject=' + subject + '&body=' + body;
            window.location.href = mailtoLink;
            closeDownloadModal();
        }
        
        function createPrintableContent() {
            var userData = currentUserData;
            var interests = userData && userData.interests ? userData.interests.join(', ') : 'general sightseeing';
            
            var content = '<h1>üçÄ Your Ring of Kerry Adventure</h1>';
            content += '<div class="summary">';
            content += '<strong>' + userData.duration + '-Day Itinerary</strong> ‚Ä¢ ' + userData.travelMonth + ' 2025 ‚Ä¢ ' + userData.groupSize + ' people ‚Ä¢ ‚Ç¨' + userData.budget + '/day budget<br>';
            content += 'Interests: ' + interests;
            content += '</div>';
            content += document.getElementById('itineraryContent').innerHTML;
            content += '<hr style="margin: 30px 0;">';
            content += '<p><em>Generated by Ring of Kerry Tours - ringofkerrytours.com</em></p>';
            
            return content;
        }
        
        function createTextContent() {
            var userData = currentUserData;
            var interests = userData && userData.interests ? userData.interests.join(', ') : 'general sightseeing';
            
            var tempDiv = document.createElement('div');
            tempDiv.innerHTML = currentItinerary;
            var plainText = tempDiv.textContent || tempDiv.innerText || '';
            
            var content = 'RING OF KERRY ADVENTURE\n';
            content += userData.duration + '-Day Itinerary ‚Ä¢ ' + userData.travelMonth + ' 2025 ‚Ä¢ ' + userData.groupSize + ' people ‚Ä¢ ‚Ç¨' + userData.budget + '/day budget\n';
            content += 'Interests: ' + interests + '\n\n';
            content += plainText + '\n\n';
            content += 'Generated by Ring of Kerry Tours - ringofkerrytours.com';
            
            return content;
        }
        
        function printItinerary() {
            console.log("printItinerary called");
            window.print();
        }
        
        window.onclick = function(event) {
            var shareModal = document.getElementById('shareModal');
            var downloadModal = document.getElementById('downloadModal');
            
            if (event.target === shareModal) {
                shareModal.style.display = 'none';
            }
            if (event.target === downloadModal) {
                downloadModal.style.display = 'none';
            }
        };
        
        console.log("Script loaded successfully");
    </script>
</body>
</html>
